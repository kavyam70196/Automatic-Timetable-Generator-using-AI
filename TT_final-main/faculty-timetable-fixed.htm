<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Schedule - MIT Mysore</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(30, 64, 175, 0.3);
        }
        
        .header-text {
            flex: 1;
            text-align: center;
            padding: 0 25px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }
        
        .btn-back { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .btn-download { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-load { background: linear-gradient(135deg, #17a2b8, #138496); color: white; }
        
        .faculty-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid #e3e6f0;
        }
        
        .faculty-selector h3 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        select, input {
            padding: 12px 15px;
            border: 2px solid #e3e6f0;
            border-radius: 8px;
            font-size: 14px;
            margin-right: 15px;
            margin-bottom: 10px;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .timetable-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            overflow-x: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid #e3e6f0;
        }
        
        .timetable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .timetable th, .timetable td {
            border: 2px solid #e3e6f0;
            padding: 12px 8px;
            text-align: center;
            font-size: 12px;
            vertical-align: middle;
        }
        
        .timetable th {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            font-weight: bold;
            color: white;
            font-size: 13px;
        }
        
        .timetable td {
            background: #ffffff;
            min-height: 70px;
            vertical-align: middle;
            position: relative;
        }
        
        .period-slot {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 8px;
            padding: 10px 6px;
            margin: 3px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }
        
        .period-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
        }
        
        .subject-name {
            font-weight: bold;
            color: #1e40af;
            font-size: 12px;
            margin-bottom: 4px;
        }
        
        .section-info {
            color: #64748b;
            font-size: 10px;
            margin: 2px 0;
            font-weight: 500;
        }
        
        .room-info {
            color: #059669;
            font-size: 10px;
            font-weight: bold;
            background: #ecfdf5;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 2px;
        }
        
        .cross-dept {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
        }
        
        .lab-session {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left: 4px solid #10b981;
        }
        
        .free-period {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #64748b;
            font-style: italic;
            border-left: 4px solid #94a3b8;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .no-schedule {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .schedule-summary {
            background: linear-gradient(135deg, #dbeafe 0%, #f0f9ff 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        
        .schedule-summary h4 {
            color: #1e40af;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .faculty-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .faculty-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }
        
        .faculty-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .faculty-name {
            font-size: 16px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 8px;
        }
        
        .faculty-info {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .btn-view {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center; color: white;">
            <div class="loading-spinner"></div>
            <div style="margin-top: 20px; font-size: 18px; font-weight: bold;">Loading Schedule...</div>
        </div>
    </div>

    <div class="header">
        <img src="left-logo.png" alt="MET Logo" style="height: 70px; width: 70px; border-radius: 50%; border: 2px solid #000;">
        <div class="header-text">
            <h1>üìÖ MY SCHEDULE</h1>
            <p><strong>Faculty Timetable Viewer</strong></p>
        </div>
        <img src="right-logo.png" alt="MIT Logo" style="height: 70px; width: 70px; border-radius: 50%; border: 2px solid #000;">
    </div>

    <div class="controls">
        <button class="control-btn btn-back" onclick="goBack()">‚Üê Back</button>
        <button class="control-btn btn-download" onclick="downloadSchedule()" id="downloadBtn" style="display: none;">üì• Download PDF</button>
    </div>

    <div class="faculty-selector">
        <h3>Department Faculty Timetables</h3>
        <div style="margin-top: 15px;">
            <select id="academicYearSelect" onchange="loadDepartmentFaculty()">
                <option value="">--Select Academic Year--</option>
            </select>
            <button class="control-btn btn-download" onclick="downloadAllTimetables()">üì• Download All Faculty Timetables</button>
        </div>
    </div>

    <div id="facultyList" style="display: none;">
        <h3 style="color: #1e40af; margin: 20px 0;">Faculty in Department</h3>
        <div id="facultyCards" class="faculty-grid"></div>
    </div>

    <div class="timetable-container" id="timetableContainer" style="display: none;">
        <div class="schedule-summary" id="scheduleSummary"></div>
        <table class="timetable" id="timetableTable">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                    <th>Saturday</th>
                </tr>
            </thead>
            <tbody id="timetableBody">
                <!-- Timetable content will be populated here -->
            </tbody>
        </table>
    </div>

    <div class="no-schedule" id="noSchedule" style="display: none;">
        <h3>No Schedule Found</h3>
        <p>Please select a faculty member and academic year to view the schedule.</p>
    </div>

    <script>
        const SUPABASE_URL = 'https://bkmzyhroignpjebfpqug.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrbXp5aHJvaWducGplYmZwcXVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MjA1NDUsImV4cCI6MjA3Mjk5NjU0NX0.ICE2eYzFZvz0dtNpAa5YlJTZD-idc2J76wn1ZeHwwck';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        const currentDepartment = urlParams.get('dept') || localStorage.getItem('currentDepartment');

        const timeSlots = [
            { id: 1, name: 'Period 1', time: '09:00 - 10:00' },
            { id: 2, name: 'Period 2', time: '10:00 - 11:00' },
            { id: 3, name: 'Period 3', time: '11:15 - 12:15' },
            { id: 4, name: 'Period 4', time: '12:15 - 13:15' },
            { id: 5, name: 'Period 5', time: '14:00 - 15:00' },
            { id: 6, name: 'Period 6', time: '15:00 - 16:00' }
        ];

        const days = ['Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        document.addEventListener('DOMContentLoaded', function() {
            loadAcademicYears();
        });

        async function loadDepartmentFaculty() {
            const academicYear = document.getElementById('academicYearSelect').value;
            if (!academicYear) {
                document.getElementById('facultyList').style.display = 'none';
                return;
            }
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                const { data: facultyData, error: facultyError } = await supabase
                    .from('faculty')
                    .select('*')
                    .eq('department', currentDepartment)
                    .order('name');
                
                if (facultyError) throw facultyError;

                const facultyCards = document.getElementById('facultyCards');
                facultyCards.innerHTML = '';
                
                for (const faculty of facultyData) {
                    const { data: timetableData } = await supabase
                        .from('timetables')
                        .select('*')
                        .eq('faculty_name', faculty.name)
                        .eq('academic_year', academicYear)
                        .eq('is_finalized', true)
                        .limit(1);
                    
                    const hasSchedule = timetableData && timetableData.length > 0;
                    
                    const card = document.createElement('div');
                    card.className = 'faculty-card';
                    card.innerHTML = `
                        <div class="faculty-name">${faculty.name}</div>
                        <div class="faculty-info">${faculty.initials} | ${faculty.designation?.replace('_', ' ') || 'Faculty'}</div>
                        <div class="faculty-info">${faculty.department}</div>
                        <div style="margin-top: 10px;">
                            ${hasSchedule ? 
                                `<button class="btn-view" onclick="viewFacultyTimetable('${faculty.name}', '${academicYear}')">üìÖ View Timetable</button>` :
                                `<span style="color: #64748b; font-style: italic;">No timetable available</span>`
                            }
                        </div>
                    `;
                    facultyCards.appendChild(card);
                }
                
                document.getElementById('facultyList').style.display = 'block';

            } catch (error) {
                console.error('Error loading department faculty:', error);
                alert('Error loading faculty: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        async function loadAcademicYears() {
            try {
                const { data, error } = await supabase
                    .from('timetables')
                    .select('academic_year')
                    .not('academic_year', 'is', null);
                
                if (error) throw error;

                const uniqueYears = [...new Set(data.map(item => item.academic_year))];
                const yearSelect = document.getElementById('academicYearSelect');
                yearSelect.innerHTML = '<option value="">--Select Academic Year--</option>';
                
                uniqueYears.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading academic years:', error);
            }
        }

        async function viewFacultyTimetable(facultyName, academicYear) {
            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                const { data, error } = await supabase
                    .from('timetables')
                    .select('*')
                    .eq('faculty_name', facultyName)
                    .eq('academic_year', academicYear)
                    .eq('is_finalized', true)
                    .order('day')
                    .order('time_slot');
                
                if (error) throw error;

                if (data && data.length > 0) {
                    displaySchedule(data, facultyName);
                    document.getElementById('timetableContainer').style.display = 'block';
                    document.getElementById('noSchedule').style.display = 'none';
                    document.getElementById('downloadBtn').style.display = 'inline-block';
                    window.currentFaculty = { name: facultyName, academicYear: academicYear };
                } else {
                    document.getElementById('timetableContainer').style.display = 'none';
                    document.getElementById('noSchedule').style.display = 'block';
                    document.getElementById('downloadBtn').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading schedule:', error);
                alert('Error loading schedule: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        function displaySchedule(scheduleData, facultyName) {
            const schedule = {};
            days.forEach(day => {
                schedule[day] = {};
                timeSlots.forEach(slot => schedule[day][slot.id] = null);
            });

            scheduleData.forEach(entry => {
                if (schedule[entry.day]) schedule[entry.day][entry.time_slot] = entry;
            });

            const totalClasses = scheduleData.filter(e => e.subject_code !== 'FREE').length;
            const departments = [...new Set(scheduleData.map(e => e.department))];
            const subjects = [...new Set(scheduleData.filter(e => e.subject_code !== 'FREE').map(e => e.subject_name || e.subject_code))];
            const sections = [...new Set(scheduleData.map(e => `${e.department}-${e.section}`))];
            const labClasses = scheduleData.filter(e => e.type === 'lab').length;
            const theoryClasses = scheduleData.filter(e => e.type === 'theory' && e.subject_code !== 'FREE').length;
            const crossDeptClasses = scheduleData.filter(e => e.is_cross_dept).length;
            const freeSlots = 30 - totalClasses;

            document.getElementById('scheduleSummary').innerHTML = `
                <h4>üìä Schedule Summary for ${facultyName}</h4>
                <div class="summary-grid">
                    <div class="summary-item"><strong>üìö Total Classes:</strong><br>${totalClasses} periods</div>
                    <div class="summary-item"><strong>üèõÔ∏è Theory:</strong><br>${theoryClasses} periods</div>
                    <div class="summary-item"><strong>üî¨ Lab Sessions:</strong><br>${labClasses} periods</div>
                    <div class="summary-item"><strong>üîÑ Cross-Dept:</strong><br>${crossDeptClasses} classes</div>
                    <div class="summary-item"><strong>‚è∞ Free Periods:</strong><br>${freeSlots} slots</div>
                    <div class="summary-item"><strong>üè¢ Departments:</strong><br>${departments.join(', ')}</div>
                    <div class="summary-item"><strong>üìñ Subjects:</strong><br>${subjects.length} unique</div>
                    <div class="summary-item"><strong>üë• Sections:</strong><br>${sections.join(', ')}</div>
                </div>
            `;

            const tbody = document.getElementById('timetableBody');
            tbody.innerHTML = '';

            timeSlots.forEach(slot => {
                const row = document.createElement('tr');
                const timeCell = document.createElement('td');
                timeCell.innerHTML = `<strong>${slot.name}</strong><br><small>${slot.time}</small>`;
                timeCell.style.background = '#e3f2fd';
                row.appendChild(timeCell);

                days.forEach(day => {
                    const cell = document.createElement('td');
                    const entry = schedule[day][slot.id];
                    
                    if (entry) {
                        let cellClass = 'period-slot';
                        if (entry.type === 'lab') cellClass += ' lab-session';
                        if (entry.is_cross_dept) cellClass += ' cross-dept';
                        if (entry.subject_code === 'FREE') cellClass += ' free-period';

                        const subjectDisplay = entry.subject_code === 'FREE' ? 'FREE' : (entry.subject_name || entry.subject_code);
                        const typeIndicator = entry.type === 'lab' ? ' üî¨' : entry.type === 'free' ? ' ‚è∞' : '';
                        const crossDeptIndicator = entry.is_cross_dept ? ' üîÑ' : '';
                        const deptInfo = entry.is_cross_dept && entry.teaching_dept ? 
                            `${entry.teaching_dept} ‚Üí ${entry.department}` : entry.department;

                        cell.innerHTML = `
                            <div class="${cellClass}">
                                <div class="subject-name">${subjectDisplay}${typeIndicator}${crossDeptIndicator}</div>
                                <div class="section-info">${deptInfo} - Sec ${entry.section}</div>
                                <div class="room-info">üìç ${entry.room || 'TBA'}</div>
                            </div>
                        `;
                    } else {
                        cell.innerHTML = '<div class="period-slot free-period">‚è∞ Free Period</div>';
                    }
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });
        }

        function downloadSchedule() {
            if (!window.currentFaculty) {
                alert('Please view a faculty timetable first');
                return;
            }
            const { name: facultyName, academicYear } = window.currentFaculty;
            const printWindow = window.open('', '_blank');
            const timetableHTML = document.getElementById('timetableContainer').innerHTML;
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Faculty Schedule - ${facultyName} - ${academicYear}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 15px; }
                        .schedule-summary { background: #f8faff; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
                        .timetable { width: 100%; border-collapse: collapse; }
                        .timetable th, .timetable td { border: 1px solid #333; padding: 8px; text-align: center; font-size: 10px; }
                        .timetable th { background: #e3f2fd; font-weight: bold; }
                        .period-slot { padding: 4px; margin: 1px 0; }
                        .subject-name { font-weight: bold; font-size: 9px; }
                        .section-info { font-size: 8px; }
                        .room-info { font-size: 8px; }
                        .cross-dept { background: #fff3cd; }
                        .lab-session { background: #e8f5e9; }
                        .free-period { background: #f8f9fa; }
                    </style>
                </head>
                <body>
                    <h1>Faculty Schedule - ${facultyName}</h1>
                    <p>Academic Year: ${academicYear} | Department: ${currentDepartment}</p>
                    ${timetableHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        async function downloadAllTimetables() {
            const academicYear = document.getElementById('academicYearSelect').value;
            if (!academicYear) {
                alert('Please select an academic year first');
                return;
            }
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            try {
                const { data: facultyData } = await supabase
                    .from('faculty')
                    .select('*')
                    .eq('department', currentDepartment)
                    .order('name');
                
                const facultyWithTimetables = [];
                
                for (const faculty of facultyData) {
                    const { data: timetableData } = await supabase
                        .from('timetables')
                        .select('*')
                        .eq('faculty_name', faculty.name)
                        .eq('academic_year', academicYear)
                        .eq('is_finalized', true)
                        .order('day')
                        .order('time_slot');
                    
                    if (timetableData && timetableData.length > 0) {
                        facultyWithTimetables.push({ faculty, timetableData });
                    }
                }
                
                if (facultyWithTimetables.length === 0) {
                    alert('No finalized timetables found');
                    return;
                }
                
                const printWindow = window.open('', '_blank');
                let allHTML = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>All Faculty Timetables - ${currentDepartment} - ${academicYear}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 15px; }
                            .page { page-break-after: always; min-height: 100vh; }
                            .timetable { width: 100%; border-collapse: collapse; }
                            .timetable th, .timetable td { border: 1px solid #333; padding: 6px; text-align: center; font-size: 9px; }
                            .timetable th { background: #e3f2fd; }
                            .period-slot { padding: 3px; }
                            .subject-name { font-weight: bold; font-size: 8px; }
                            .section-info { font-size: 7px; }
                            .cross-dept { background: #fff3cd; }
                            .lab-session { background: #e8f5e9; }
                            .free-period { background: #f8f9fa; }
                        </style>
                    </head>
                    <body>
                `;
                
                facultyWithTimetables.forEach((item, index) => {
                    const { faculty, timetableData } = item;
                    allHTML += `<div class="page">`;
                    allHTML += `<h1>${faculty.name} - ${currentDepartment}</h1>`;
                    allHTML += `<p>Academic Year: ${academicYear}</p>`;
                    
                    const schedule = {};
                    days.forEach(day => {
                        schedule[day] = {};
                        timeSlots.forEach(slot => schedule[day][slot.id] = null);
                    });
                    
                    timetableData.forEach(entry => {
                        if (schedule[entry.day]) schedule[entry.day][entry.time_slot] = entry;
                    });
                    
                    allHTML += `<table class="timetable"><thead><tr><th>Time</th><th>Tuesday</th><th>Wednesday</th><th>Thursday</th><th>Friday</th><th>Saturday</th></tr></thead><tbody>`;
                    
                    timeSlots.forEach(slot => {
                        allHTML += '<tr>';
                        allHTML += `<td><strong>${slot.name}</strong><br>${slot.time}</td>`;
                        
                        days.forEach(day => {
                            const entry = schedule[day][slot.id];
                            if (entry) {
                                let cellClass = 'period-slot';
                                if (entry.type === 'lab') cellClass += ' lab-session';
                                if (entry.is_cross_dept) cellClass += ' cross-dept';
                                if (entry.subject_code === 'FREE') cellClass += ' free-period';
                                
                                const subjectDisplay = entry.subject_code === 'FREE' ? 'FREE' : (entry.subject_name || entry.subject_code);
                                allHTML += `<td><div class="${cellClass}"><div class="subject-name">${subjectDisplay}</div><div class="section-info">${entry.department} - Sec ${entry.section}</div></div></td>`;
                            } else {
                                allHTML += '<td><div class="period-slot free-period">Free</div></td>';
                            }
                        });
                        
                        allHTML += '</tr>';
                    });
                    
                    allHTML += '</tbody></table></div>';
                });
                
                allHTML += '</body></html>';
                
                printWindow.document.write(allHTML);
                printWindow.document.close();
                printWindow.print();
                
            } catch (error) {
                console.error('Error generating all timetables:', error);
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        function goBack() {
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'page.htm';
            }
        }
    </script>
</body>
</html>